function isUUID(t){var e=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/;return t?e.test(t):!1}function encodeParams(t){tail=[];var e=[];if(t instanceof Array)for(i in t)e=t[i],e instanceof Array&&e.length>1&&tail.push(e[0]+"="+encodeURIComponent(e[1]));else for(var n in t)if(t.hasOwnProperty(n)){var o=t[n];if(o instanceof Array)for(i in o)e=o[i],tail.push(n+"="+encodeURIComponent(e));else tail.push(n+"="+encodeURIComponent(o))}return tail.join("&")}window.console=window.console||{},window.console.log=window.console.log||function(){},window.Usergrid=window.Usergrid||{},Usergrid=Usergrid||{},Usergrid.SDK_VERSION="0.10.06",Usergrid.Client=function(t){this.URI=t.URI||"https://api.usergrid.com",this.orgName=t.orgName,this.appName=t.appName,this.buildCurl=t.buildCurl||!1,this.logging=t.logging||!1,this._callTimeout=t.callTimeout||3e4,this._callTimeoutCallback=t.callTimeoutCallback||null,this.logoutCallback=t.logoutCallback||null},Usergrid.Client.prototype.request=function(t,e){var i=this,n=t.method||"GET",o=t.endpoint,r=t.body||{},s=t.qs||{},l=t.mQuery||!1;if(l)var a=this.URI+"/"+o;else var a=this.URI+"/"+this.orgName+"/"+this.appName+"/"+o;i.getToken()&&(s.access_token=i.getToken());var c=encodeParams(s);c&&(a+="?"+c),r=JSON.stringify(r);var u=new XMLHttpRequest;u.open(n,a,!0),r&&(u.setRequestHeader("Content-Type","application/json"),u.setRequestHeader("Accept","application/json")),u.onerror=function(){i._end=(new Date).getTime(),i.logging&&console.log("success (time: "+i.calcTimeDiff()+"): "+n+" "+a),i.logging&&console.log("Error: API call failed at the network level."),clearTimeout(g);var t=!0;"function"==typeof e&&e(t,data)},u.onload=function(t){if(i._end=(new Date).getTime(),i.logging&&console.log("success (time: "+i.calcTimeDiff()+"): "+n+" "+a),clearTimeout(g),t=JSON.parse(u.responseText),200!=u.status){var o=t.error,r=t.error_description;if(i.logging&&console.log("Error ("+u.status+")("+o+"): "+r),("auth_expired_session_token"==o||"auth_missing_credentials"==o||"auth_unverified_oath"==o||"expired_token"==o||"unauthorized"==o||"auth_invalid"==o)&&"function"==typeof i.logoutCallback)return i.logoutCallback(!0,t);"function"==typeof e&&e(!0,t)}else"function"==typeof e&&e(!1,t)};var g=setTimeout(function(){u.abort(),"function"===i._callTimeoutCallback?i._callTimeoutCallback("API CALL TIMEOUT"):i.callback("API CALL TIMEOUT")},i._callTimeout);if(this.logging&&console.log("calling: "+n+" "+a),this.buildCurl){var p={uri:a,body:r,method:n};this.buildCurlCall(p)}this._start=(new Date).getTime(),u.send(r)},Usergrid.Client.prototype.createGroup=function(t,e){var i=t.getOnExist||!1,t={path:t.path,client:this,data:t},n=new Usergrid.Group(t);n.fetch(function(t,o){var r=t&&"service_resource_not_found"===o.error||"no_name_specified"===o.error||"null_pointer"===o.error||!t&&i;r?n.save(function(t){"function"==typeof e&&e(t,n)}):"function"==typeof e&&e(t,n)})},Usergrid.Client.prototype.createEntity=function(t,e){var i=t.getOnExist||!1,t={client:this,data:t},n=new Usergrid.Entity(t);n.fetch(function(o,r){var s=o&&"service_resource_not_found"===r.error||"no_name_specified"===r.error||"null_pointer"===r.error||!o&&i;s?(n.set(t.data),n.save(function(t){"function"==typeof e&&e(t,n)})):"function"==typeof e&&e(o,n)})},Usergrid.Client.prototype.restoreEntity=function(t){var e=JSON.parse(t),i={client:this,data:e},n=new Usergrid.Entity(i);return n},Usergrid.Client.prototype.getEntity=function(t,e){var t={client:this,data:t},i=new Usergrid.Entity(t);i.fetch(function(t){"function"==typeof e&&e(t,i)})},Usergrid.Client.prototype.createCollection=function(t,e){t.client=this;var i=new Usergrid.Collection(t,function(t){"function"==typeof e&&e(t,i)})},Usergrid.Client.prototype.restoreCollection=function(t){var e=JSON.parse(t);e.client=this;var i=new Usergrid.Collection(e);return i},Usergrid.Client.prototype.getFeedForUser=function(t,e){var i={method:"GET",endpoint:"users/"+t+"/feed"};this.request(i,function(t,i){"function"==typeof e&&(t?e(t):e(t,i,i.entities))})},Usergrid.Client.prototype.createUserActivity=function(t,e,i){e.type="users/"+t+"/activities";var e={client:this,data:e},n=new Usergrid.Entity(e);n.save(function(t){"function"==typeof i&&i(t,n)})},Usergrid.Client.prototype.createUserActivityWithEntity=function(t,e,i){var n=t.get("username"),o={actor:{displayName:n,uuid:t.get("uuid"),username:n,email:t.get("email"),picture:t.get("picture"),image:{duration:0,height:80,url:t.get("picture"),width:80}},verb:"post",content:e};this.createUserActivity(n,o,i)},Usergrid.Client.prototype.calcTimeDiff=function(){var t=0,e=this._end-this._start;try{t=(e/10/60).toFixed(2)}catch(i){return 0}return t},Usergrid.Client.prototype.setToken=function(t){var e="token"+this.appName+this.orgName;this.token=t,"undefined"!=typeof Storage&&(t?localStorage.setItem(e,t):localStorage.removeItem(e))},Usergrid.Client.prototype.getToken=function(){var t="token"+this.appName+this.orgName;return this.token?this.token:"undefined"!=typeof Storage?localStorage.getItem(t):null},Usergrid.Client.prototype.signup=function(t,e,i,n,o){var r={type:"users",username:t,password:e,email:i,name:n};this.createEntity(r,o)},Usergrid.Client.prototype.login=function(t,e,i){var n=this,o={method:"POST",endpoint:"token",body:{username:t,password:e,grant_type:"password"}};this.request(o,function(t,e){var o={};if(t&&n.logging)console.log("error trying to log user in");else{var r={client:n,data:e.user};o=new Usergrid.Entity(r),n.setToken(e.access_token)}"function"==typeof i&&i(t,e,o)})},Usergrid.Client.prototype.loginFacebook=function(t,e){var i=this,n={method:"GET",endpoint:"auth/facebook",qs:{fb_access_token:t}};this.request(n,function(t,n){var o={};if(t&&i.logging)console.log("error trying to log user in");else{var r={client:i,data:n.user};o=new Usergrid.Entity(r),i.setToken(n.access_token)}"function"==typeof e&&e(t,n,o)})},Usergrid.Client.prototype.getLoggedInUser=function(t){if(this.getToken()){var e=this,i={method:"GET",endpoint:"users/me"};this.request(i,function(i,n){if(i)e.logging&&console.log("error trying to log user in"),"function"==typeof t&&t(i,n,null);else{var o={client:e,data:n.entities[0]},r=new Usergrid.Entity(o);"function"==typeof t&&t(i,n,r)}})}else t(!0,null,null)},Usergrid.Client.prototype.isLoggedIn=function(){return this.getToken()?!0:!1},Usergrid.Client.prototype.logout=function(){this.setToken(null)},Usergrid.Client.prototype.buildCurlCall=function(t){var e="curl",i=(t.method||"GET").toUpperCase(),n=t.body||{},o=t.uri;return e+="POST"===i?" -X POST":"PUT"===i?" -X PUT":"DELETE"===i?" -X DELETE":" -X GET",e+=" "+o,'"{}"'!==n&&"GET"!==i&&"DELETE"!==i&&(e+=" -d '"+n+"'"),console.log(e),e},Usergrid.Client.prototype.registerDevice=function(t,e){if(t){var i=t.notifier+".notifier.id",n={type:"devices",uuid:this.getDeviceUUID()};n[i]=t.deviceToken;var o={client:this,data:n},r=new Usergrid.Entity(o);r.save(e)}else e(!0)},Usergrid.Client.prototype.sendPushToDevice=function(t,e){if(t){var i=t.notifier,n={type:"notifier",name:t.notifier},o=this;this.getEntity(n,function(n,r){if(n)e(n,r);else{var s={type:t.path};"google"===r.get("provider")?(s.payloads={},s.payloads[i]=t.message):"apple"===r.get("provider")&&(s.payloads={},s.payloads[i]={aps:{alert:t.message,sound:t.sound}});var l={client:o,data:s},a=new Usergrid.Entity(l);a.save(e)}})}else e(!0)},Usergrid.Client.prototype.randomUUID=function(){for(var t=[],e="0123456789ABCDEF",i=0;36>i;i++)t[i]=Math.floor(16*Math.random());t[14]=4,t[19]=8|3&t[19];for(var i=0;36>i;i++)t[i]=e[t[i]];return t[8]=t[13]=t[18]=t[23]="-",t.join("")},Usergrid.Client.prototype.getDeviceUUID=function(){if("string"==typeof window.localStorage.getItem("deviceUUID"))return window.localStorage.getItem("deviceUUID");var t=this.randomUUID();return window.localStorage.setItem("deviceUUID",t),window.localStorage.getItem("deviceUUID")},Usergrid.Entity=function(t){t&&(this._client=t.client,this._data=t.data||{})},Usergrid.Entity.prototype.serialize=function(){return JSON.stringify(this._data)},Usergrid.Entity.prototype.get=function(t){return t?this._data[t]:this._data},Usergrid.Entity.prototype.set=function(t,e){if("object"==typeof t)for(var i in t)this._data[i]=t[i];else"string"==typeof t?null===e?delete this._data[t]:this._data[t]=e:this._data=null},Usergrid.Entity.prototype.save=function(t){var e=this.get("type"),i="POST";isUUID(this.get("uuid"))&&(i="PUT",e+="/"+this.get("uuid"));var n=this,o={},r=this.get();for(var s in r)"metadata"!==s&&"created"!==s&&"modified"!==s&&"type"!==s&&"activated"!==s&&"uuid"!==s&&(o[s]=r[s]);var l={method:i,endpoint:e,body:o};this._client.request(l,function(i,o){if(i&&n._client.logging){if(console.log("could not save entity"),"function"==typeof t)return t(i,o,n)}else{if(o.entities&&o.entities.length){var s=o.entities[0];n.set(s)}var l="user"===n.get("type")&&r.oldpassword&&r.newpassword;if(l){var a={};a.oldpassword=r.oldpassword,a.newpassword=r.newpassword;var c={method:"PUT",endpoint:e+"/password",body:a};n._client.request(c,function(e,i){e&&n._client.logging&&console.log("could not update user"),n.set("oldpassword",null),n.set("newpassword",null),"function"==typeof t&&t(e,i,n)})}else"function"==typeof t&&t(i,o,n)}})},Usergrid.Entity.prototype.fetch=function(t){var e=this.get("type"),i=this;if(this.get("uuid"))e+="/"+this.get("uuid");else if("users"===e){if(this.get("username"))e+="/"+this.get("username");else if("function"==typeof t){var n="no_name_specified";return i._client.logging&&console.log(n),t(!0,{error:n},i)}}else if("a path"===e){if(this.get("path"))e+="/"+encodeURIComponent(this.get("name"));else if("function"==typeof t){var n="no_name_specified";return i._client.logging&&console.log(n),t(!0,{error:n},i)}}else if(this.get("name"))e+="/"+encodeURIComponent(this.get("name"));else if("function"==typeof t){var n="no_name_specified";return i._client.logging&&console.log(n),t(!0,{error:n},i)}var o={method:"GET",endpoint:e};this._client.request(o,function(e,n){if(e&&i._client.logging)console.log("could not get entity");else if(n.user)i.set(n.user),i._json=JSON.stringify(n.user,null,2);else if(n.entities&&n.entities.length){var o=n.entities[0];i.set(o)}"function"==typeof t&&t(e,n,i)})},Usergrid.Entity.prototype.destroy=function(t){var e=this.get("type");if(isUUID(this.get("uuid")))e+="/"+this.get("uuid");else if("function"==typeof t){var i="Error trying to delete object - no uuid specified.";n._client.logging&&console.log(i),t(!0,i)}var n=this,o={method:"DELETE",endpoint:e};this._client.request(o,function(e,i){e&&n._client.logging?console.log("entity could not be deleted"):n.set(null),"function"==typeof t&&t(e,i)})},Usergrid.Entity.prototype.connect=function(t,e,i){var n=this,o=e.get("type"),r=this.getEntityId(e);if(r){var s=this.get("type"),l=this.getEntityId(this);if(l){var a=s+"/"+l+"/"+t+"/"+o+"/"+r,c={method:"POST",endpoint:a};this._client.request(c,function(t,e){t&&n._client.logging&&console.log("entity could not be connected"),"function"==typeof i&&i(t,e)})}else if("function"==typeof i){var u="Error in connect - no uuid specified.";n._client.logging&&console.log(u),i(!0,u)}}else if("function"==typeof i){var u="Error trying to delete object - no uuid specified.";n._client.logging&&console.log(u),i(!0,u)}},Usergrid.Entity.prototype.getEntityId=function(t){var e=!1;return isUUID(t.get("uuid"))?e=t.get("uuid"):"users"===type?e=t.get("username"):t.get("name")&&(e=t.get("name")),e},Usergrid.Entity.prototype.getConnections=function(t,e){var i=this,n=this.get("type"),o=this.getEntityId(this);if(o){var r=n+"/"+o+"/"+t+"/",s={method:"GET",endpoint:r};this._client.request(s,function(n,o){n&&i._client.logging&&console.log("entity could not be connected"),i[t]={};for(var r=o.entities.length,s=0;r>s;s++)"user"===o.entities[s].type?i[t][o.entities[s].username]=o.entities[s]:i[t][o.entities[s].name]=o.entities[s];"function"==typeof e&&e(n,o,o.entities)})}else if("function"==typeof e){var l="Error in getConnections - no uuid specified.";i._client.logging&&console.log(l),e(!0,l)}},Usergrid.Entity.prototype.disconnect=function(t,e,i){var n=this,o=e.get("type"),r=this.getEntityId(e);if(r){var s=this.get("type"),l=this.getEntityId(this);if(l){var a=s+"/"+l+"/"+t+"/"+o+"/"+r,c={method:"DELETE",endpoint:a};this._client.request(c,function(t,e){t&&n._client.logging&&console.log("entity could not be disconnected"),"function"==typeof i&&i(t,e)})}else if("function"==typeof i){var u="Error in connect - no uuid specified.";n._client.logging&&console.log(u),i(!0,u)}}else if("function"==typeof i){var u="Error trying to delete object - no uuid specified.";n._client.logging&&console.log(u),i(!0,u)}},Usergrid.Collection=function(t,e){if(t&&(this._client=t.client,this._type=t.type,this.qs=t.qs||{},this._list=t.list||[],this._iterator=t.iterator||-1,this._previous=t.previous||[],this._next=t.next||null,this._cursor=t.cursor||null,t.list))for(var i=t.list.length,n=0;i>n;n++){var o=this._client.restoreEntity(t.list[n]);this._list[n]=o}e&&this.fetch(e)},Usergrid.Collection.prototype.serialize=function(){var t={};t.type=this._type,t.qs=this.qs,t.iterator=this._iterator,t.previous=this._previous,t.next=this._next,t.cursor=this._cursor,this.resetEntityPointer();var e=0;for(t.list=[];this.hasNextEntity();){var i=this.getNextEntity();t.list[e]=i.serialize(),e++}return t=JSON.stringify(t)},Usergrid.Collection.prototype.fetch=function(t){var e=this,i=this.qs;this._cursor?i.cursor=this._cursor:delete i.cursor;var n={method:"GET",endpoint:this._type,qs:this.qs};this._client.request(n,function(i,n){if(i&&e._client.logging)console.log("error getting collection");else{var o=n.cursor||null;if(e.saveCursor(o),n.entities){e.resetEntityPointer();var r=n.entities.length;e._list=[];for(var s=0;r>s;s++){var l=n.entities[s].uuid;if(l){var a=n.entities[s]||{},c={type:e._type,client:e._client,uuid:l,data:a},u=new Usergrid.Entity(c),g=e._list.length;e._list[g]=u}}}}"function"==typeof t&&t(i,n)})},Usergrid.Collection.prototype.addEntity=function(t,e){var i=this;t.type=this._type,this._client.createEntity(t,function(t,n){if(!t){var o=i._list.length;i._list[o]=n}"function"==typeof e&&e(t,n)})},Usergrid.Collection.prototype.destroyEntity=function(t,e){var i=this;t.destroy(function(t,n){t?(i._client.logging&&console.log("could not destroy entity"),"function"==typeof e&&e(t,n)):i.fetch(e)})},Usergrid.Collection.prototype.getEntityByUUID=function(t,e){var i={data:{type:this._type,uuid:t},client:this._client},n=new Usergrid.Entity(i);n.fetch(e)},Usergrid.Collection.prototype.getFirstEntity=function(){var t=this._list.length;return t>0?this._list[0]:null},Usergrid.Collection.prototype.getLastEntity=function(){var t=this._list.length;return t>0?this._list[t-1]:null},Usergrid.Collection.prototype.hasNextEntity=function(){var t=this._iterator+1,e=t>=0&&this._list.length>t;return e?!0:!1},Usergrid.Collection.prototype.getNextEntity=function(){this._iterator++;var t=this._iterator>=0&&this._iterator<=this._list.length;return t?this._list[this._iterator]:!1},Usergrid.Collection.prototype.hasPrevEntity=function(){var t=this._iterator-1,e=t>=0&&this._list.length>t;return e?!0:!1},Usergrid.Collection.prototype.getPrevEntity=function(){this._iterator--;var t=this._iterator>=0&&this._iterator<=this._list.length;return t?this.list[this._iterator]:!1},Usergrid.Collection.prototype.resetEntityPointer=function(){this._iterator=-1},Usergrid.Collection.prototype.saveCursor=function(t){this._next!==t&&(this._next=t)},Usergrid.Collection.prototype.resetPaging=function(){this._previous=[],this._next=null,this._cursor=null},Usergrid.Collection.prototype.hasNextPage=function(){return this._next},Usergrid.Collection.prototype.getNextPage=function(t){this.hasNextPage()&&(this._previous.push(this._cursor),this._cursor=this._next,this._list=[],this.fetch(t))},Usergrid.Collection.prototype.hasPreviousPage=function(){return this._previous.length>0},Usergrid.Collection.prototype.getPreviousPage=function(t){this.hasPreviousPage()&&(this._next=null,this._cursor=this._previous.pop(),this._list=[],this.fetch(t))},Usergrid.Group=function(t){this._path=t.path,this._list=[],this._client=t.client,this._data=t.data||{},this._data.type="groups"},Usergrid.Group.prototype=new Usergrid.Entity,Usergrid.Group.prototype.fetch=function(t){var e=this,i="groups/"+this._path,n="groups/"+this._path+"/users",o={method:"GET",endpoint:i},r={method:"GET",endpoint:n};this._client.request(o,function(i,n){if(i)e._client.logging&&console.log("error getting group"),"function"==typeof t&&t(i,n);else if(n.entities){var o=n.entities[0];e._data=o||{},e._client.request(r,function(i,n){if(i&&e._client.logging)console.log("error getting group users");else if(n.entities){var o=n.entities.length;e._list=[];for(var r=0;o>r;r++){var s=n.entities[r].uuid;if(s){var l=n.entities[r]||{},a={type:l.type,client:e._client,uuid:s,data:l},c=new Usergrid.Entity(a);e._list.push(c)}}}"function"==typeof t&&t(i,n,e._list)})}})},Usergrid.Group.prototype.members=function(t){"function"==typeof t&&t(null,this._list)},Usergrid.Group.prototype.add=function(t,e){var i=this,t={method:"POST",endpoint:"groups/"+this._path+"/users/"+t.user.get("username")};this._client.request(t,function(t,n){t?"function"==typeof e&&e(t,n,n.entities):i.fetch(e)})},Usergrid.Group.prototype.remove=function(t,e){var i=this,t={method:"DELETE",endpoint:"groups/"+this._path+"/users/"+t.user.get("username")};this._client.request(t,function(t,n){t?"function"==typeof e&&e(t,n):i.fetch(e)})},Usergrid.Group.prototype.feed=function(t){var e=this,i="groups/"+this._path+"/feed",n={method:"GET",endpoint:i};this._client.request(n,function(i,n){i&&e.logging&&console.log("error trying to log user in"),"function"==typeof t&&t(i,n,n.entities)})},Usergrid.Group.prototype.createGroupActivity=function(t,e){var i=t.user,t={actor:{displayName:i.get("username"),uuid:i.get("uuid"),username:i.get("username"),email:i.get("email"),picture:i.get("picture"),image:{duration:0,height:80,url:i.get("picture"),width:80}},verb:"post",content:t.content};t.type="groups/"+this._path+"/activities";var t={client:this._client,data:t},n=new Usergrid.Entity(t);n.save(function(t){"function"==typeof e&&e(t,n)})};